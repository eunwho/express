<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<link type="text/css" rel="stylesheet" href="/app.css" media="all">

	<title>Auto Grease Monitor</title>
<!-- start of goole gauge --> 
<script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
<script type="text/javascript">
	google.charts.load('current', {'packages':['corechart']});
	var pinData = [['Element','Density',{role:'style'}],
					['LUBE1',100, 'blue'],
					['LUBE2',100, 'darkgray'],
					['LUBE3',100, 'darkgray'],
					['LUBE4',100, 'darkgray']
					];
	function drawPin( pinData,id){
		var data = new google.visualization.arrayToDataTable(pinData);
		var view = new google.visualization.DataView(data);
		view.setColumns([0,1,
						{calc:'stringify', sourceColumn:1,
						 type: 'string', role:'annotation'},
						 2]);
		var options = {
			width: 300,	bar  : {groupWidth:'30%'},
			legend: { position: 'none' },
			vAxis:{title:'Pin State',minValue: 0, maxValue: 100}
			};	
			
		var chart = new google.visualization.ColumnChart(document.getElementById(id));
		chart.draw(view, options);
	}

<!-- start of google scatter -->

	var graphData1 = [];
	var graphData2 = [];
	var graphData3 = [];
	var graphData4 = [];

	for( var i = 0 ; i < 1000; i++){
		graphData1.push([i]);
		graphData1[i].push(700*1);
		graphData1[i].push(700*1);
		graphData1[i].push(700*1);
		graphData1[i].push(700*1);
		graphData1[i].push(700*1);
		graphData1[i].push(700*1);
	}
	graphData1[0][1] = 0;
	graphData1[0][2] = 1000;


      google.charts.load('current', {'packages':['corechart', 'scatter']});
      google.charts.setOnLoadCallback(drawStuff);

<!-- drawStuff() -->

      function drawStuff( ) {
		var chartDiv = [];

		for( var i = 0 ; i < 4 ; i++ ){
	        chartDiv.push(document.getElementById('chart_div'+(i+1)));
		}	

        data1 = new google.visualization.DataTable();
        data2 = new google.visualization.DataTable();
        data3 = new google.visualization.DataTable();
        data4 = new google.visualization.DataTable();

		data1.addColumn('number', 'Date');
       	for( var k = 1 ; k < 7 ; k++){ 
			data1.addColumn('number', 'Sens'+k);
		}

		data2.addColumn('number', 'Date');
       	for( var k = 1 ; k < 7 ; k++){ 
			data2.addColumn('number', 'Sens'+k);
		}
		
		data3.addColumn('number', 'Date');
       	for( var k = 1 ; k < 7 ; k++){ 
			data3.addColumn('number', 'Sens'+k);
		}
		data4.addColumn('number', 'Date');
       	for( var k = 1 ; k < 7 ; k++){ 
			data4.addColumn('number', 'Sens'+k);
		}

        <!-- data.addRows( graphData1); -->

        var materialOptions = {
        	chart: {
            	title: 'Sensor Values for Last Week',
            	<!-- subtitle: 'based on before last Week' -->
          	},
          	width: 500,
          	height:300,
          	series: {0: {axis: 'Sensor Value'},	},
          	axes: {	y: {'Sensor Value': {label: 'Sensor Value'},}}
        };

        function drawMaterialChart1( ) {
			var materialChart = new google.charts.Scatter(chartDiv[0]);
			data1.addRows( graphData1);
          	materialChart.draw(data1, google.charts.Scatter.convertOptions(materialOptions));
        }
        drawMaterialChart1( );

        function drawMaterialChart2( ) {
			var materialChart = new google.charts.Scatter(chartDiv[1]);
			data2.addRows( graphData2);
          	materialChart.draw(data2, google.charts.Scatter.convertOptions(materialOptions));
        }
        drawMaterialChart2( );

        function drawMaterialChart3( ) {
			var materialChart = new google.charts.Scatter(chartDiv[2]);
			data3.addRows( graphData3);
          	materialChart.draw(data3, google.charts.Scatter.convertOptions(materialOptions));
        }
        drawMaterialChart3( );

        function drawMaterialChart4( ) {
			var materialChart = new google.charts.Scatter(chartDiv[3]);
			data4.addRows( graphData4);
          	materialChart.draw(data4, google.charts.Scatter.convertOptions(materialOptions));
        }
        drawMaterialChart4( );
    };
</script>
<!-- end of goole gauge --> 
<script>
	function tableCreate( ){

		var title = ['M','version','group','sensor#','MY', 'MP','SH','SL','DH','DL',
						'%V','S.V','B.V','C.T', 'C.V', 
    					'DB','D.Id','NI','No.S'];

		var tableWidth = ['60','60','60','60','40','40','30','60','40','40','30','60','60','60','30','130'];
		var x = document.createElement('TABLE');
		x.setAttribute("id","tblData2");
		var tbl = document.getElementById('table2').appendChild(x);
		var tr = tbl.insertRow();
		for( var i = 0; i < 16 ; i ++){
			var td = tr.insertCell();
			td.appendChild(document.createTextNode(title[i+4]));
			td.style.border = '1px solid black';
			td.setAttribute('width',tableWidth[i]);
			td.setAttribute('align','center');			
		}
		for(var j = 0 ; j < 5 ; j++){

			var tr = tbl.insertRow();	
			for( var i = 0; i < 16 ; i ++){
				var td = tr.insertCell();
				td.appendChild(document.createTextNode(['000']));
				td.style.border = '1px solid black';
				td.setAttribute('align','center');			
			}
		}
		
	}

	function changeContent(id, row, cell, content) {

		var test = row;
		
		if( test === 1 ){ test = 7;
		} else { test = row -1;}
		
    	var a = document.getElementById(id).rows[test].cells;
    	a[cell].setAttribute('bgColor','white');
    	
    	var x = document.getElementById(id).rows[row].cells;
    	x[cell].innerHTML = content;
    	x[cell].setAttribute('bgColor','yellow');
	}		
	function writeTable(msg, test, no){

		var val ='---';
       	var tmp = msg.split(",");

		console.log("msg :", tmp);
		for(var i = 4 ; i < 19 ; i++){

			if( tmp[0] === 'M'){ val = tmp[i];}
		
			if( no === 2 ){
				changeContent('tblData2',test,i-4,val);
			} else{
				changeContent('tblData3',test,i-4,val);
			}
		}
	
		var d = new Date();
		var weekday = new Array(7);
		weekday[0]= "Sun";
		weekday[1]= "Mon";
		weekday[2]= "Tues";
		weekday[3]= "Wed";
		weekday[4]= "Thur";
		weekday[5]= "Fri";
		weekday[6]= "Sat";

		var n = weekday[d.getDay()];
		var h = d.getHours();
 	 	var m = d.getMinutes();
		val = n + ' : ' + h + ' : ' + m ;

		if ( no === 2 ){
			changeContent('tblData2',test,15,val);
		} else{
			changeContent('tblData3',test,15,val);
	}
}   
		

</script>

	<script src="/socket.io/socket.io.js"></script>
	<script src="http://code.jquery.com/jquery-1.10.2.js"></script>

	<script>

		var count1 = 0;
		var count2 = 0;

		//var socket = io.connect('http://192.168.110.10:7532');
		var socket = io.connect('http://192.168.0.10:7532');

		var signalToggle = true;
		socket.on('stalled',function( data ) {
			var $target = $('div[data-x = ' + data.x + '][data-y = ' + data.y + ']');
			$target.removeClass('init moving').addClass('stalled');
			console.log("reserve return");
		});

		socket.on('moved',function( data ) {
			var $target = $('div[data-x = ' + data.x + '][data-y = ' + data.y + ']');
			$target.removeClass('init stalled').addClass('moved');
		});

		socket.on('endDevice',function( data ) {
			// console.log(data.endDevice.rxData);

			if( count1 < 7) { count1 = count1 +1;
			} else { count1 = 1;}

			writeTable(data.endDevice.rxData,count1,2);
			
			var count = data.endDevice.numSens;
			console.log("data.endDevice.numSense:" + count );

			for(var i = 0 ; i < 4 ; i++){

				if( i < count ){
					var a = data.sens[i].status;
					var sum = 0;

					if( a[5] == 1 )			{ sum = 100;
					} else if ( a[4] == 1) 	{ sum = 83;
					} else if ( a[3] == 1) 	{ sum = 66;
					} else if ( a[2] == 1) 	{ sum = 50;
					} else if ( a[1] == 1) 	{ sum = 33;
					} else if ( a[0] == 1) 	{ sum = 16;
					} else	{ sum = 0;}

					pinData[i+1][1] = sum;
					pinData[i+1][2] = 'blue';
				}else{
					pinData[i+1][1] = 100;
					pinData[i+1][2] = 'gray';
				}
			}
			drawPin( pinData,"right_div1");
		});

		socket.on('endDevice1',function( data ) {
			if( count2 < 7) { count2 = count2 +1;
			} else { count2 = 1;}
			writeTable(data.endDevice.rxData,count2,3);

			var count = data.endDevice.numSens;
			console.log("data.endDevice.numSense:" + count );

			for(var i = 0 ; i < 4 ; i++){
				if( i < count ){
					var a = data.sens[i].status;				
					var sum = 0;

					if( a[5] == 1 )			{ sum = 100;
					} else if ( a[4] == 1) 	{ sum = 83;
					} else if ( a[3] == 1) 	{ sum = 66;
					} else if ( a[2] == 1) 	{ sum = 50;
					} else if ( a[1] == 1) 	{ sum = 33;
					} else if ( a[0] == 1) 	{ sum = 16;
					} else	{ sum = 0;}

					pinData[i+1][1] = sum;
					pinData[i+1][2] = 'blue';
				}else{
					pinData[i+1][1] = 100;
					pinData[i+1][2] = 'gray';
				}
			}
			drawPin( pinData,"right_div2");

		});

		socket.on('received',function( data ) {

			var $target = $('div[data-x = ' + data.x + '][data-y = ' + data.y + ']');
			console.log('received');

			if( signalToggle == true){
				signalToggle = false;
				//$target.removeClass('init stalled moved signalOn1').addClass('signalOn2');
				$target.removeClass('init stalled moved signalOn1').addClass('signalOn2');
			} else{
				signalToggle = true;
				//$target.removeClass('init stalled moved signalOn2').addClass('signalOn1');
				$target.removeClass('init stalled moved signalOn2').addClass('signalOn1');
			}
			console.log("received On");
		});
		socket.on('graphData',function( docs ) {
			graphData1 = docs.table4;
			graphData2 = docs.table3;
			graphData3 = docs.table2;
			graphData4 = docs.table1;
			console.log(docs.masterName);
			console.log(docs.sensorList);
			drawStuff();
		});
	</script>


	<script>		
		$(document).ready(function() {
			// define variable
			var onClickSeat = function () {
				var x = $(this).attr('data-x');
				var y = $(this).attr('data-y');

				var a = '';
				if( y < 3 ) { 
					a = 'Boom Port Side Group '+ (y*1+1);
				} else if (y < 6 ){
					a = 'Boom Star Board Side Group ' + (y*1 +1);
				} else if ( y == 6 ){
					a = 'Backstay Port Side ';
				} else if ( y == 7 ){
					a = 'Backstay Start Board Side ';
				} else {
					a = ' Error';
				}

				var vGraphTitle = a + ' #' + (x*1+1);
				document.getElementById('graphTitle').innerHTML = vGraphTitle;
				socket.emit('clickDevice',{	x: x, y: y });
			};

			$.getJSON('/wsnObj', { dummy: new Date().getTime() }, function(wsnObj){
	
				// console.log('wnsObj',wsnObj);
				// Creat endDevice Sheet
				$.each(wsnObj, function (groupId, endDeviceGroup ) {
					// Create Document object
					var $line = $('<div></div>').addClass('line');
					$.each(endDeviceGroup, function( deviceId, sensCtrl ){
						// Create Document Object and ADD to var $line
						var $output = $('<div></div>',{	'class':'seat',	'data-x': deviceId,'data-y': groupId }).appendTo($line);
						$output.on('click',onClickSeat);
						
						var status = sensCtrl.endDevice.status;

						if( status == 0 ){			
							$output.removeClass("moved stalled").addClass('init'); 
						}else if( status == 1 ) {	
							$output.removeClass("init stalled").addClass('moved'); 
							$output.addClass('moved'); 
						}else if( status == 2 ) {
							$output.removeClass("init moved").addClass('stalled'); 
						} 
					});
					// Add Document Object
					$line.appendTo('section');
				});
			});
			
			tableCreate();
		});
	</script>

	<script>
		function startTime() {
		    var today = new Date();

		    var h = today.getHours();
		    var m = today.getMinutes();
		    var s = today.getSeconds();
		    m = checkTime(m);
		    s = checkTime(s);
		    document.getElementById('dispTime').innerHTML = Date();
		    h + ":" + m + ":" + s;
		    var t = setTimeout(startTime, 30000	);
		}
		
		function checkTime(i) {
		    if (i < 10) {i = "0" + i};  // add zero in front of numbers < 10
		    return i;
		}

		function drawGraph(){
			socket.emit('reqGraph',{
				x: 'L,4,3',
				y: 'G718'
			});
		}
			
	</script>

<body onload="startTime()">


	<div align="center" class="wrapper">
	<header>
		<H2>LUBRICATION RECORD HHI HD-10000 Auto Grease Monitoring System </h2>
	</header>


   	<div id="subTitle">
	    <div class = "content2">
	    	<div>
	    		<div id= "subtile"> [ Ship's name : HD10000 ]  &nbsp &nbsp [ Lubrication part : Crane &nbsp] &nbsp &nbsp <a id="dispTime"></a></div>  
	    	</div>
	    </div> 
	</div>

	<div id="tablecontainer">

   	<aside> 
   		<table id="tbthsensor">
   			<tr>	<th>LOC. PART</th><th> PMP/S NO </th> </tr>	
	    		<tr> <th rowspan="3">JIB PORT</th><th>NO.1</th> </tr>
	 		<tr> <th>NO.2</th> </tr>
	 		<tr> <th>NO.3</th> </tr>
			
	    		<tr> <th rowspan="3">JIB STBD</th><th>NO.1</th> </tr>
	 		<tr>	<th>NO.2</th>	</tr>
	 		<tr>	<th>NO.3</th>	</tr>
	 		<tr>	<th>A-PORT</th><th>NO.1</th> </tr>
	 		<tr>	<th>A-STBD</th><th>NO.1</th> </tr>
	    </table>
	</aside>


	<div id="div1">
		<div class= "sensornumber">
			<div>1</div><div>2</div><div>3</div><div>4</div><div>5</div><div>6</div><div>7</div><div>8</div><div>9</div><div>10</div><div>11</div><div>12</div><div>13</div><div>14</div><div>15</div><div>16</div><div>17</div><div>18</div><div>19</div><div>20</div><div>21</div><div>22</div><div>23</div><div>24</div><div>25</div><div>26</div><div>27</div><div>28</div><div>29</div><div>30</div><div>31</div><div>32</div><div>33</div><div>34</div><div>35</div><div>36</div>
			</div>
		</div>	

 		<section>
		</section>
	</div>
	
</wrapper>

	<div id="wrap1" style="width: 1280px; height: 620px;">
			<H2 align="center"  id = "graphTitle"> Boom Port Side Group1 #1 </H2> 
		
			<div id="right_div1" style="width: 300px; height: 145px;">
			</div>	
		
			<div id="left_div1" style="width: 855px; height: 145px;">
				<table id='table2' width = '860'></table>
			</div>
			<table id="scatter">
				<tr> 
					<th> <div id="chart_div1" style="" > </div> </th>
					<th> <div id="chart_div2" style="" > </div> </th>
				</tr>
				<tr> 
					<th> <div id="chart_div3" style="" > </div> </th>
					<th> <div id="chart_div4" style="" > </div> </th>
				</tr>
			</table>
			
	</div>	
	<div id="test1">		
	

		<p> Eunwho Power Electronics:  eunwho.com eunwho@naver.com &nbsp;&nbsp;&nbsp; tel  82 51 262 7532. fax  82 51 262 7534  H.P. 82 010 3027 4445 Copyright 2016 </p>
	
	</div>

	<div id="chart_div5" style="width: 900px; height: 500px;"></div>

</body>

</html>


	

