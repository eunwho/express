<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<link type="text/css" rel="stylesheet" href="/app.css" media="all">

	<title>Auto Grease Monitor</title>


	<script type="text/javascript">
		window.onload = function () {
			var dataSet1 = [{ x: 23, y: 4 },{ x: 28, y: 5 },{ x: 39, y: 9 },
					{ x: 34, y: 8 },{ x: 24, y: 3 },{ x: 29, y: 7 },
					{ x: 29, y: 5 },{ x: 23, y: 6 },{ x: 27, y: 7 },
					{ x: 34, y: 11 },{ x: 36, y: 9 },{ x: 33, y: 5 },
					{ x: 32, y: 8 },{ x: 21, y: 2 }
					];

			var dataSet2 = [
					{ x: 24, y: 2 },{ x: 27, y: 3 },{ x: 35, y: 7 },
					{ x: 32, y: 6 },{ x: 29, y: 4 },{ x: 23, y: 5 },
					{ x: 24, y: 3 },{ x: 26, y: 4 },{ x: 24, y: 5 },
					{ x: 33, y: 7 },{ x: 34, y: 6 },{ x: 30, y: 4 },
					{ x: 37, y: 8 },{ x: 24, y: 2 }
					];
			 
			var chart = new CanvasJS.Chart("chartContainer", {
				title: {
					text: "Server Performance",
					fontSize: 20
				},
				animationEnabled: true,
				axisX: {
					title: "Server Load (TPS)",
					titleFontSize: 18

				},
				axisY: {
					title: "Response Time (sec)",
					titleFontSize: 16
				},
				legend: {
					verticalAlign: 'bottom',
					horizontalAlign: "center"
				},

				data: [
				{
					type: "scatter",
					markerType: "square",
					toolTipContent: "<span style='\"'color: {color};'\"'><strong>{name}</strong></span><br/><strong> Load</strong> {x} <br/><strong> Response</strong></span> {y}sec",

					name: "Server Pluto",
					showInLegend: true,
					dataPoints: dataSet1

				},
				{
					type: "scatter",
					name: "Server Mars",
					markerType: "triangle",
					showInLegend: true,
					toolTipContent: "<span style='\"'color: {color};'\"'><strong>{name}</strong></span><br/><strong> Load</strong> {x} <br/><strong> Response</strong></span> {y}sec",

					dataPoints: dataSet2 

				}
				],
				legend: {
					cursor: "pointer",
					itemclick: function (e) {
						if (typeof (e.dataSeries.visible) === "undefined" || e.dataSeries.visible) {
							e.dataSeries.visible = false;
						}
						else {
							e.dataSeries.visible = true;
						}
						chart.render();
					}
				}
			});

			chart.render();
		}
	</script>

<!-- start of goole gauge --> 
<script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>

<script type="text/javascript">

	google.charts.load('current', {'packages':['corechart']});

	var pinData = [['Element','Density',{role:'style'}],
					['LUBE1',100, 'blue'],
					['LUBE2',100, 'darkgray'],
					['LUBE3',100, 'darkgray'],
					['LUBE4',100, 'darkgray']
					];
					
	function drawPin( pinData,id){
		var data = new google.visualization.arrayToDataTable(pinData);

		var view = new google.visualization.DataView(data);
		view.setColumns([0,1,
						{calc:'stringify',
						 sourceColumn:1,
						 type: 'string',
						 role:'annotation'},
						 2]);
						
		var options = {
			// title: 'Lubrication Pin state',
			width: 300,
			bar  : {groupWidth:'30%'},
			legend: { position: 'none' },
			vAxis:{title:'Pin State',minValue: 0, maxValue: 100}
			};	
			
		var chart = new google.visualization.ColumnChart(document.getElementById(id));
		chart.draw(view, options);
	}

</script>
<!-- end of goole gauge --> 

<script>
	function tableCreate( ){

		var title = ['M','version','group','sensor#','MY', 'MP','SH','SL','DH','DL',
						'%V','S.V','B.V','C.T', 'C.V', 
    					'DB','D.Id','NI','No.S'
					];

		var tableWidth = ['60','60','60','60','40','40','30','60','40','40','30','60','60','60','30','130'];
		var x = document.createElement('TABLE');
		x.setAttribute("id","tblData2");

		var tbl = document.getElementById('table2').appendChild(x);

		var tr = tbl.insertRow();

		for( var i = 0; i < 16 ; i ++){
			var td = tr.insertCell();
			td.appendChild(document.createTextNode(title[i+4]));
			td.style.border = '1px solid black';
			td.setAttribute('width',tableWidth[i]);
			td.setAttribute('align','center');			
		}

		for(var j = 0 ; j < 7 ; j++){

			var tr = tbl.insertRow();	
			for( var i = 0; i < 16 ; i ++){
				var td = tr.insertCell();
				td.appendChild(document.createTextNode(['000']));
				td.style.border = '1px solid black';
				td.setAttribute('align','center');			

			}
		}

		var x = document.createElement('TABLE');
		x.setAttribute("id","tblData3");

		var tbl = document.getElementById('table3').appendChild(x);

		var tr = tbl.insertRow();

		for( var i = 0; i < 16 ; i ++){
			var td = tr.insertCell();
			td.appendChild(document.createTextNode(title[i+4]));
			td.style.border = '1px solid black';
			td.setAttribute('width',tableWidth[i]);
			td.setAttribute('align','center');			

		}

		for(var j = 0 ; j < 7 ; j++){

			var tr = tbl.insertRow();	
			for( var i = 0; i < 16 ; i ++){
				var td = tr.insertCell();
				td.appendChild(document.createTextNode(['000']));
				td.style.border = '1px solid black';
				td.setAttribute('align','center');			

			}	
		}
	}

	function changeContent(id, row, cell, content) {

		var test = row;
		
		if( test === 1 ){ test = 7;
		} else { test = row -1;}
		
    	var a = document.getElementById(id).rows[test].cells;
    	a[cell].setAttribute('bgColor','white');
    	
    	var x = document.getElementById(id).rows[row].cells;
    	x[cell].innerHTML = content;
    	x[cell].setAttribute('bgColor','yellow');
	}		


	function writeTable(msg, test, no){

		var val ='---';
       	var tmp = msg.split(",");

		console.log("msg :", tmp);


		for(var i = 4 ; i < 19 ; i++){

			if( tmp[0] === 'M'){ val = tmp[i];}
		
			if( no === 2 ){
				changeContent('tblData2',test,i-4,val);
			} else{
				changeContent('tblData3',test,i-4,val);
			}
		}
	
		var d = new Date();
		var weekday = new Array(7);
		weekday[0]= "Sun";
		weekday[1]= "Mon";
		weekday[2]= "Tues";
		weekday[3]= "Wed";
		weekday[4]= "Thur";
		weekday[5]= "Fri";
		weekday[6]= "Sat";

		var n = weekday[d.getDay()];
		var h = d.getHours();
 	 	var m = d.getMinutes();
		val = n + ' : ' + h + ' : ' + m ;

		if ( no === 2 ){
			changeContent('tblData2',test,15,val);
		} else{
			changeContent('tblData3',test,15,val);
	}
}   
		

</script>

	<script src="/socket.io/socket.io.js"></script>
	<script src="http://code.jquery.com/jquery-1.10.2.js"></script>

	<script>

		var count1 = 0;
		var count2 = 0;

		//var socket = io.connect('http://192.168.110.10:7532');
		var socket = io.connect('http://192.168.0.10:7532');

		var signalToggle = true;
		socket.on('stalled',function( data ) {
			var $target = $('div[data-x = ' + data.x + '][data-y = ' + data.y + ']');
			$target.removeClass('init moving').addClass('stalled');
			console.log("reserve return");
		});

		socket.on('moved',function( data ) {
			var $target = $('div[data-x = ' + data.x + '][data-y = ' + data.y + ']');
			$target.removeClass('init stalled').addClass('moved');
		});


		socket.on('endDevice',function( data ) {
			// console.log(data.endDevice.rxData);

			if( count1 < 7) { count1 = count1 +1;
			} else { count1 = 1;}

			writeTable(data.endDevice.rxData,count1,2);
			
			var count = data.endDevice.numSens;
			console.log("data.endDevice.numSense:" + count );

			for(var i = 0 ; i < 4 ; i++){

				if( i < count ){
					var a = data.sens[i].status;
					var sum = 0;

					if( a[5] == 1 )			{ sum = 100;
					} else if ( a[4] == 1) 	{ sum = 83;
					} else if ( a[3] == 1) 	{ sum = 66;
					} else if ( a[2] == 1) 	{ sum = 50;
					} else if ( a[1] == 1) 	{ sum = 33;
					} else if ( a[0] == 1) 	{ sum = 16;
					} else	{ sum = 0;}

					pinData[i+1][1] = sum;
					pinData[i+1][2] = 'blue';
				}else{
					pinData[i+1][1] = 100;
					pinData[i+1][2] = 'gray';
				}
			}
			drawPin( pinData,"right_div1");
		});

		socket.on('endDevice1',function( data ) {
			if( count2 < 7) { count2 = count2 +1;
			} else { count2 = 1;}
			writeTable(data.endDevice.rxData,count2,3);

			var count = data.endDevice.numSens;
			console.log("data.endDevice.numSense:" + count );

			for(var i = 0 ; i < 4 ; i++){
				if( i < count ){
					var a = data.sens[i].status;				
					var sum = 0;

					if( a[5] == 1 )			{ sum = 100;
					} else if ( a[4] == 1) 	{ sum = 83;
					} else if ( a[3] == 1) 	{ sum = 66;
					} else if ( a[2] == 1) 	{ sum = 50;
					} else if ( a[1] == 1) 	{ sum = 33;
					} else if ( a[0] == 1) 	{ sum = 16;
					} else	{ sum = 0;}

					pinData[i+1][1] = sum;
					pinData[i+1][2] = 'blue';
				}else{
					pinData[i+1][1] = 100;
					pinData[i+1][2] = 'gray';
				}
			}
			drawPin( pinData,"right_div2");

		});

		socket.on('received',function( data ) {

			var $target = $('div[data-x = ' + data.x + '][data-y = ' + data.y + ']');
			console.log('received');

			if( signalToggle == true){
				signalToggle = false;
				//$target.removeClass('init stalled moved signalOn1').addClass('signalOn2');
				$target.removeClass('init stalled moved signalOn1').addClass('signalOn2');
			} else{
				signalToggle = true;
				//$target.removeClass('init stalled moved signalOn2').addClass('signalOn1');
				$target.removeClass('init stalled moved signalOn2').addClass('signalOn1');
			}
			console.log("received On");
		});
		
		socket.on('graphData',function( docs ) {
			// var $target = $('div[data-x = ' + data.x + '][data-y = ' + data.y + ']');
			// $target.removeClass('init stalled').addClass('moved');
			console.log(docs);
		});

	</script>


	<script>		
		$(document).ready(function() {
			// define variable
			var onClickSeat = function () {
				var x = $(this).attr('data-x');
				var y = $(this).attr('data-y');
				socket.emit('clickDevice',{
					x: x,
					y: y
				});
			};

			$.getJSON('/wsnObj', { dummy: new Date().getTime() }, function(wsnObj){
	
				// console.log('wnsObj',wsnObj);
				// Creat endDevice Sheet
				$.each(wsnObj, function (groupId, endDeviceGroup ) {
					// Create Document object
					var $line = $('<div></div>').addClass('line');
					$.each(endDeviceGroup, function( deviceId, sensCtrl ){
						// Create Document Object and ADD to var $line
						var $output = $('<div></div>',{	'class':'seat',	'data-x': deviceId,'data-y': groupId }).appendTo($line);
						$output.on('click',onClickSeat);
						
						var status = sensCtrl.endDevice.status;

						if( status == 0 ){			
							$output.removeClass("moved stalled").addClass('init'); 
						}else if( status == 1 ) {	
							$output.removeClass("init stalled").addClass('moved'); 
							$output.addClass('moved'); 
						}else if( status == 2 ) {
							$output.removeClass("init moved").addClass('stalled'); 
						} 
					});
					// Add Document Object
					$line.appendTo('section');
				});
			});
			
			tableCreate();
		});
	</script>

	<script>
		function startTime() {
		    var today = new Date();

		    var h = today.getHours();
		    var m = today.getMinutes();
		    var s = today.getSeconds();
		    m = checkTime(m);
		    s = checkTime(s);
		    document.getElementById('dispTime').innerHTML = Date();
		    h + ":" + m + ":" + s;
		    var t = setTimeout(startTime, 30000	);
		}
		
		function checkTime(i) {
		    if (i < 10) {i = "0" + i};  // add zero in front of numbers < 10
		    return i;
		}

		function drawGraph(){
			socket.emit('reqGraph',{
				x: 1,
				y: 1
			});
		}
			
	</script>

	<script type="text/javascript" src="./script.js"></script>
	<script src="/canvasjs.min.js"></script>

<body onload="startTime()">


	<div class="wrapper">
	<header>
		<h1>LUBRICATION RECORD</h1>
		<h2> HHI HD-10000 Auto Grease Monitoring System </h2>
	</header>


   	<div id="subTitle">
	    <div class = "content2">
	    	<div>
	    		<div id= "subtile"> [ Ship's name : HD10000    ] &nbsp &nbsp &nbsp &nbsp &nbsp [ Lubrication part : Crane &nbsp] &nbsp &nbsp <a id="dispTime"></a></div>  
	    	</div>
	    </div> 
	</div>

	<div id="tablecontainer">

   	<aside> 
   		<table id="tbthsensor">
   			<tr>	<th>LOC. PART</th><th> PMP/S NO </th> </tr>	
	    		<tr> <th rowspan="3">JIB PORT</th><th>NO.1</th> </tr>
	 		<tr> <th>NO.2</th> </tr>
	 		<tr> <th>NO.3</th> </tr>
			
	    		<tr> <th rowspan="3">JIB STBD</th><th>NO.1</th> </tr>
	 		<tr>	<th>NO.2</th>	</tr>
	 		<tr>	<th>NO.3</th>	</tr>
	 		<tr>	<th>A-PORT</th><th>NO.1</th> </tr>
	 		<tr>	<th>A-STBD</th><th>NO.1</th> </tr>
	    </table>
	</aside>


	<div id="div1">
		<div class= "sensornumber">
			<div>1</div><div>2</div><div>3</div><div>4</div><div>5</div><div>6</div><div>7</div><div>8</div><div>9</div><div>10</div><div>11</div><div>12</div><div>13</div><div>14</div><div>15</div><div>16</div><div>17</div><div>18</div><div>19</div><div>20</div><div>21</div><div>22</div><div>23</div><div>24</div><div>25</div><div>26</div><div>27</div><div>28</div><div>29</div><div>30</div><div>31</div><div>32</div><div>33</div><div>34</div><div>35</div><div>36</div>
			</div>
		</div>	

 		<section>
		</section>
	</div>
	
</wrapper>

	<div id="wrap1" style="width: 1250px; height: 455px;">
			<div id="right_div1" style="width: 300px; height: 180px;">
			</div>	
			<div id="left_div1" style="width: 855px; height: 180px;">
				<table id='table2' width = '860'></table>
			</div>
			<div id="right_div2" style="width: 300px; height: 180px;"></div>
			<div id="left_div2" style="width: 855px; height: 180px;">
				<table id='table3' width = '860'></table>
			</div>
	</div>	
	<div id="test1">		
	
		<p> Eunwho Power Electronics:  eunwho.com eunwho@naver.com &nbsp;&nbsp;&nbsp; tel  82 51 262 7532. fax  82 51 262 7534  H.P. 82 010 3027 4445 Copyright 2016 </p>
	
	</div>

	<button onclick='drawGraph()'>Draw Graph</button>

	<div id="chartContainer" style="height: 400px; width: 100%;">

</body>

</html>


	

